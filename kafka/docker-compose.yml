version: "3.5"

services:
  zookeeper:
    hostname: zookeeper
    container_name: cont-zookeeper
    build:
      context: docker/zookeeper
    volumes:
    - ./docker/zookeeper/zoo.cfg:/conf/zoo.cfg

    ports:
      - 2181:2181

    networks:
      - zookeeper-net
      - mariadb-univ_net

  kafka:
    depends_on:
      - zookeeper
    hostname: kafka
    container_name: cont-kafka

    environment:
      ZOOKEEPER_IP: cont-zookeeper
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: cont-zookeeper:2181
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://cont-kafka:29092,PLAINTEXT_HOST://localhost:9092
      # Following line is needed for Kafka versions 0.11+
      # in case you run less than 3 Kafka brokers in your
      # cluster because the broker config
      # `offsets.topic.replication.factor` (default: 3)
      # is now enforced upon topic creation
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

    build:
      context: docker/kafka

    # opcional, se ver√≠an todos los brokers y particiones (carpetas)
    #volumes:
    # - ./docker/kafka/config:/kafka/config (peta)
    #- ./docker/kafka/data:/data
    #- ./docker/kafka/logs:/logs

    ports:
      - 29092:29092 #broker (contenedores)
      - 9092:9092 #broker (publico)
      # - 7203:7203 #publishing

    networks:
      - zookeeper-net
      - mariadb-univ_net

networks:
  zookeeper-net:
  mariadb-univ_net:
    external: true
