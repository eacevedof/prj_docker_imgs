version: "3.5"

services:
  zookeeper:
    image: wurstmeister/zookeeper
    #hostname: zookeeper
    #container_name: cont-zookeeper (no le gusta)

    ports:
      - 2181:2181

    networks:
      - zookeeper-net
      - mariadb-univ_net

  kafka:
    image: wurstmeister/kafka:latest
    depends_on:
      - zookeeper
    #hostname: kafka
    #container_name: cont-kafka

    environment:
      DOCKER_API_VERSION: 1.22
      #HOSTNAME_COMMAND: "docker info | grep ^Name: | cut -d' ' -f 2"
      KAFKA_ADVERTISED_HOST_NAME: host.docker.internal
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
      KAFKA_ADVERTISED_LISTENERS: INSIDE://:9092,OUTSIDE://_{KAFKA_ADVERTISED_HOST_NAME}:9094
      KAFKA_LISTENERS: INSIDE://:9092,OUTSIDE://:9094
      KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE

    ports:
      - 9094:9094

    volumes:
      - ./docker/kafka/config:/opt/kafka/config
      - /var/run/docker.sock:/var/run/docker.sock

    networks:
      - zookeeper-net
      - mariadb-univ_net

networks:
  zookeeper-net:
  mariadb-univ_net:
    external: true
