version: "3.5"

services:
  zookeeper:
    hostname: zookeeper
    container_name: cont-zookeeper
    build:
      context: docker/zookeeper
    volumes:
    - ./docker/zookeeper/zoo.cfg:/conf/zoo.cfg

    ports:
      - 2181:2181

    networks:
      - zookeeper-net
      - mariadb-univ_net

  kafka:
    # ches/kafka
    depends_on:
      - zookeeper
    hostname: kafka
    container_name: cont-kafka

    environment:
      ZOOKEEPER_IP: cont-zookeeper
      KAFKA_ADVERTISED_HOST_NAME: 0.0.0.0
      #KAFKA_LISTENERS: INSIDE://0.0.0.0:29092,OUTSIDE://0.0.0.0:9092
      #KAFKA_ADVERTISED_LISTENERS: INSIDE://kafka:29092,OUTSIDE://192.168.1.128:9092
      #KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
      #KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
      #KAFKA_ADVERTISED_HOST_NAME: kafka nodename nor error dns lookup
      # KAFKA_ADVERTISED_HOST_NAME: cont-kafka nodename nor servname provided ERROR kafka.conn: DNS lookup failed
      # JMX_PORT: 333 Exception thrown by the agent : java.rmi.server.ExportException: Port already in use: 333;

    build:
      context: docker/kafka

    # opcional, se ver√≠an todos los brokers y particiones (carpetas)
    #volumes:
    # - ./docker/kafka/config:/kafka/config (peta)
    #- ./docker/kafka/data:/data
    #- ./docker/kafka/logs:/logs

    ports:
      - 29092:29092 #broker (contenedores)
      - 9092:9092 #broker (publico)
      # - 7203:7203 #publishing

    networks:
      - zookeeper-net
      - mariadb-univ_net

networks:
  zookeeper-net:
  mariadb-univ_net:
    external: true
